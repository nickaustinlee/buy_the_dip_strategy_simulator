version: '3.8'

services:
  test-python-3-11:
    build:
      context: .
      dockerfile: Dockerfile.test
      args:
        PYTHON_VERSION: "3.11"
    volumes:
      - .:/app
      - test-cache-3-11:/tmp/poetry_cache
    environment:
      - PYTHONPATH=/app
    command: >
      sh -c "
        echo '=== Testing Python 3.11 ===' &&
        python --version &&
        echo 'ğŸ Running unit tests' &&
        with-venv pytest tests/unit/ -v --tb=short &&
        echo 'ğŸ”§ Testing CLI functionality' &&
        with-venv buy-the-dip --help > /dev/null &&
        echo 'ğŸ” Running type checks' &&
        with-venv mypy buy_the_dip/ --ignore-missing-imports &&
        echo 'ğŸ¨ Checking code formatting' &&
        with-venv black --check buy_the_dip/ tests/ &&
        echo 'âœ… Python 3.11 all checks passed!'
      "

  test-python-3-12:
    build:
      context: .
      dockerfile: Dockerfile.test
      args:
        PYTHON_VERSION: "3.12"
    volumes:
      - .:/app
      - test-cache-3-12:/tmp/poetry_cache
    environment:
      - PYTHONPATH=/app
    command: >
      sh -c "
        echo '=== Testing Python 3.12 ===' &&
        python --version &&
        echo 'ğŸ Running unit tests' &&
        with-venv pytest tests/unit/ -v --tb=short &&
        echo 'ğŸ”§ Testing CLI functionality' &&
        with-venv buy-the-dip --help > /dev/null &&
        echo 'ğŸ” Running type checks' &&
        with-venv mypy buy_the_dip/ --ignore-missing-imports &&
        echo 'ğŸ¨ Checking code formatting' &&
        with-venv black --check buy_the_dip/ tests/ &&
        echo 'âœ… Python 3.12 all checks passed!'
      "

  test-python-3-13:
    build:
      context: .
      dockerfile: Dockerfile.test
      args:
        PYTHON_VERSION: "3.13"
    volumes:
      - .:/app
      - test-cache-3-13:/tmp/poetry_cache
    environment:
      - PYTHONPATH=/app
    command: >
      sh -c "
        echo '=== Testing Python 3.13 ===' &&
        python --version &&
        echo 'ğŸ Running unit tests' &&
        with-venv pytest tests/unit/ -v --tb=short &&
        echo 'ğŸ”§ Testing CLI functionality' &&
        with-venv buy-the-dip --help > /dev/null &&
        echo 'ğŸ” Running type checks' &&
        with-venv mypy buy_the_dip/ --ignore-missing-imports &&
        echo 'ğŸ¨ Checking code formatting' &&
        with-venv black --check buy_the_dip/ tests/ &&
        echo 'âœ… Python 3.13 all checks passed!'
      "

  test-python-3-14:
    build:
      context: .
      dockerfile: Dockerfile.test
      args:
        PYTHON_VERSION: "3.14"
    volumes:
      - .:/app
      - test-cache-3-14:/tmp/poetry_cache
    environment:
      - PYTHONPATH=/app
    command: >
      sh -c "
        echo '=== Testing Python 3.14 ===' &&
        python --version &&
        echo 'ğŸ Running unit tests' &&
        with-venv pytest tests/unit/ -v --tb=short &&
        echo 'ğŸ”§ Testing CLI functionality' &&
        with-venv buy-the-dip --help > /dev/null &&
        echo 'ğŸ” Running type checks' &&
        with-venv mypy buy_the_dip/ --ignore-missing-imports &&
        echo 'ğŸ¨ Checking code formatting' &&
        with-venv black --check buy_the_dip/ tests/ &&
        echo 'âœ… Python 3.14 all checks passed!'
      "

volumes:
  test-cache-3-11:
  test-cache-3-12:
  test-cache-3-13:
  test-cache-3-14: