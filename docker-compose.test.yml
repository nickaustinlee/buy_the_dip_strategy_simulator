version: '3.8'

services:
  test-python-3-11:
    build:
      context: .
      dockerfile: Dockerfile.test
      args:
        PYTHON_VERSION: "3.11"
    volumes:
      - .:/app
      - test-cache-3-11:/tmp/poetry_cache
    environment:
      - PYTHONPATH=/app
    command: >
      sh -c "
        echo '=== Testing Python 3.11 ===' &&
        python --version &&
        with-venv pytest tests/unit/ -v --tb=short &&
        echo '=== CLI Test ===' &&
        with-venv buy-the-dip --help > /dev/null &&
        echo '✅ Python 3.11 tests passed!'
      "

  test-python-3-12:
    build:
      context: .
      dockerfile: Dockerfile.test
      args:
        PYTHON_VERSION: "3.12"
    volumes:
      - .:/app
      - test-cache-3-12:/tmp/poetry_cache
    environment:
      - PYTHONPATH=/app
    command: >
      sh -c "
        echo '=== Testing Python 3.12 ===' &&
        python --version &&
        with-venv pytest tests/unit/ -v --tb=short &&
        echo '=== CLI Test ===' &&
        with-venv buy-the-dip --help > /dev/null &&
        echo '✅ Python 3.12 tests passed!'
      "

  test-python-3-13:
    build:
      context: .
      dockerfile: Dockerfile.test
      args:
        PYTHON_VERSION: "3.13"
    volumes:
      - .:/app
      - test-cache-3-13:/tmp/poetry_cache
    environment:
      - PYTHONPATH=/app
    command: >
      sh -c "
        echo '=== Testing Python 3.13 ===' &&
        python --version &&
        with-venv pytest tests/unit/ -v --tb=short &&
        echo '=== CLI Test ===' &&
        with-venv buy-the-dip --help > /dev/null &&
        echo '✅ Python 3.13 tests passed!'
      "

volumes:
  test-cache-3-11:
  test-cache-3-12:
  test-cache-3-13: